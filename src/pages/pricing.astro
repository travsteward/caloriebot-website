---
import Layout from "../layouts/Layout.astro";
import ContactModal from "../components/ContactModal.astro";

// Make DISCORD_CLIENT_ID available to the frontend
const DISCORD_CLIENT_ID = import.meta.env.DISCORD_CLIENT_ID;

const pageTitle = "CalorieBot Affiliate Program | Earn 60% Commission";
const pageDescription = "Join CalorieBot's affiliate program and earn $12/month for every user who subscribes in your Discord server. Users pay $19.99/month, you keep 60% commission.";

const plans = [
  {
    name: "Starter",
    price: 29,
    period: "/month",
    description: "Perfect for friends & family",
    features: [
      "All core features included",
      "AI photo tracking",
      "Guided workouts",
      "Challenge system",
      "$5.80 per user"
    ],
    priceId: "price_1QjsjILK64haKytlUJnHI6bo",
    hasCheckout: true,
    memberLimit: "Up to 5 active members",
  },
  {
    name: "Growth",
    price: 99,
    period: "/month",
    description: "For growing communities",
    features: [
      "Everything in Starter +",
      "Group coaching platform",
      "Weekly check-in system",
      "Inactivity alerts",
      "$4.95 per user"
    ],
    priceId: "price_1QjsjFLK64haKytlEccmqs7i",
    hasCheckout: true,
    memberLimit: "Up to 20 active members",
  },
  /* Temporarily hidden
  {
    name: "Plus",
    price: 249,
    period: "/month",
    description: "For thriving communities",
    features: [
      "Everything in Growth +",
      "1-1 coaching platform",
      "Assignable coaches",
      "Priority support",
      "$4.15 per user"
    ],
    priceId: "price_1QjsjKLK64haKytlh1GJPwQb",
    hasCheckout: true,
    memberLimit: "Up to 60 active members",
  },
  {
    name: "Pro",
    price: 459,
    period: "/month",
    description: "For growing large communities",
    features: [
      "Everything in Plus +",
      "Priority feature requests",
      "Discount per user",
      "Setup onboarding",
      "$3.53 per user"
    ],
    priceId: "price_1QkYErLK64haKytlQNHgb9r6",
    hasCheckout: true,
    memberLimit: "Up to 130 active members",
  },
  {
    name: "Elite",
    price: 999,
    period: "/month",
    description: "For large communities",
    features: [
      "Everything in Pro +",
      "Custom features requests",
      "Premium support",
      "Growth mentorship discord",
      "$3.33 per user"
    ],
    priceId: "price_1QjsjBLK64haKytlmgH3MV3i",
    hasCheckout: true,
    memberLimit: "Up to 300 active members",
  },
  */
  {
    name: "Partner",
    price: "Custom",
    period: " pricing",
    description: "For large fitness coaching communities",
    features: [
      "Enterprise coaching platform suite",
      "Revenue-sharing partnership model",
      "Custom server design & branding",
      "Advanced client monitoring dashboard",
      "Detailed client progress reports",
      "Dedicated account manager",
      "Custom feature development"
    ],
    hasCheckout: false,
  },
];

// Create structured data for pricing
const priceRange = {
  minPrice: 29,
  maxPrice: 999
};

---

<Layout
  title={pageTitle}
  description={pageDescription}
  type="website"
  image="/images/pricing-preview.jpg"
  price={`${priceRange.minPrice}.00`}
>
  <ContactModal id="contact-modal" />
  <main>
    <section class="relative bg-dark text-white py-16 overflow-hidden">
      <!-- Subtle decorative elements that match the theme -->
      <div class="absolute inset-0" aria-hidden="true">
        <div class="absolute top-0 right-0 w-1/3 h-48 bg-orange-600/5 blur-3xl"></div>
        <div class="absolute bottom-0 left-0 w-1/3 h-48 bg-discord/5 blur-3xl"></div>
      </div>

      <div class="container mx-auto px-4 max-w-5xl relative">
        <div class="text-center mb-12">
          <h1 class="text-5xl md:text-6xl font-bold mb-6">
            Affiliate Program
            <br />
            <span class="text-orange-500">Earn 60% Commission</span>
          </h1>
          <p class="text-xl md:text-2xl text-gray-300">Users pay $19.99/month, you earn $12/month for every subscriber. Learn more about <a href="/blog/monetizing-fitness-community-guide/" class="text-orange-400 hover:text-orange-300 underline">monetizing your fitness community</a>.</p>
        </div>

        <div class="grid gap-6 mx-auto">
          {/* Commission Structure */}
          <div class="bg-gradient-to-r from-orange-900/40 to-orange-800/30 rounded-lg p-8 border border-orange-500/30">
            <div class="text-center mb-8">
              <h3 class="text-3xl font-bold text-white mb-4">Commission Structure</h3>
              <p class="text-xl text-gray-300">Users pay $19.99/month â€¢ You earn $12/month â€¢ We keep $7.99/month</p>
            </div>

            <div class="grid md:grid-cols-3 gap-6 text-center">
              <div class="bg-gray-800/50 rounded-lg p-6">
                <div class="text-2xl font-bold text-orange-400 mb-2">$19.99</div>
                <div class="text-gray-300">User pays monthly</div>
              </div>
              <div class="bg-gray-800/50 rounded-lg p-6">
                <div class="text-2xl font-bold text-green-400 mb-2">$12</div>
                <div class="text-gray-300">You earn (60%)</div>
              </div>
              <div class="bg-gray-800/50 rounded-lg p-6">
                <div class="text-2xl font-bold text-blue-400 mb-2">$7.99</div>
                <div class="text-gray-300">We keep (40%)</div>
              </div>
            </div>
          </div>

          {/* Earnings Examples */}
          <div class="bg-secondary rounded-lg p-8">
            <h3 class="text-2xl font-bold text-white mb-6 text-center">Monthly Earnings Examples</h3>
            <div class="grid md:grid-cols-4 gap-6">
              <div class="text-center">
                <div class="text-3xl font-bold text-orange-400 mb-2">$300</div>
                <div class="text-gray-300 mb-2">25 subscribers</div>
                <div class="text-sm text-gray-400">$12 Ã— 25 users</div>
              </div>
              <div class="text-center">
                <div class="text-3xl font-bold text-orange-400 mb-2">$600</div>
                <div class="text-gray-300 mb-2">50 subscribers</div>
                <div class="text-sm text-gray-400">$12 Ã— 50 users</div>
              </div>
              <div class="text-center">
                <div class="text-3xl font-bold text-orange-400 mb-2">$1,200</div>
                <div class="text-gray-300 mb-2">100 subscribers</div>
                <div class="text-sm text-gray-400">$12 Ã— 100 users</div>
              </div>
              <div class="text-center">
                <div class="text-3xl font-bold text-orange-400 mb-2">$2,400</div>
                <div class="text-gray-300 mb-2">200 subscribers</div>
                <div class="text-sm text-gray-400">$12 Ã— 200 users</div>
              </div>
            </div>
          </div>

          {/* Setup Process */}
          <div class="bg-secondary rounded-lg p-8">
            <h3 class="text-2xl font-bold text-white mb-6 text-center">How to Get Started</h3>
            <div class="grid md:grid-cols-3 gap-6">
              <div class="text-center">
                <div class="text-4xl mb-4">ðŸ¤–</div>
                <h4 class="text-lg font-bold text-white mb-2">1. Add Bot Free</h4>
                <p class="text-gray-300 text-sm">Add CalorieBot to your Discord server at no cost</p>
              </div>
              <div class="text-center">
                <div class="text-4xl mb-4">ðŸ’³</div>
                <h4 class="text-lg font-bold text-white mb-2">2. Connect Stripe</h4>
                <p class="text-gray-300 text-sm">Link your Stripe account for automatic commission payouts</p>
              </div>
              <div class="text-center">
                <div class="text-4xl mb-4">ðŸ’°</div>
                <h4 class="text-lg font-bold text-white mb-2">3. Earn Commissions</h4>
                <p class="text-gray-300 text-sm">Users subscribe for $19.99/month, you earn $12 automatically</p>
              </div>
            </div>
          </div>

          {/* CTA */}
          <div class="text-center">
            <a
              href={`https://discord.com/api/oauth2/authorize?client_id=${DISCORD_CLIENT_ID}&permissions=395137251392&scope=bot%20applications.commands`}
              class="inline-block bg-orange-600 hover:bg-orange-500 text-white font-bold py-4 px-10 rounded-full transition-colors text-lg"
            >
              Start Earning Today
            </a>
          </div>
        </div>
      </div>
    </section>
  </main>
</Layout>

<script define:vars={{ DISCORD_CLIENT_ID }}>
  document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll("[data-price-id]").forEach((button) => {
      button.addEventListener("click", () => {
        const priceId = button.getAttribute("data-price-id");
        const planName = button.closest('.bg-secondary').querySelector('h3').textContent;
        const price = button.closest('.bg-secondary').querySelector('.text-3xl').textContent;

        // Track checkout initiation
        sa_event("checkout_page_visit", {
          price_id: priceId,
          plan_name: planName,
          price: price,
          page: 'pricing'
        });

        const params = new URLSearchParams({
          client_id: DISCORD_CLIENT_ID,
          response_type: "code",
          scope: "identify email",
          redirect_uri: "https://caloriebot.ai/oauth/discord/callback",
          state: priceId,
          prompt: "consent",
        });

        const discordUrl = `https://discord.com/api/oauth2/authorize?${params}`;
        window.location.href = discordUrl;
      });
    });
  });
</script>

<script>
  // Fix TypeScript error by declaring the global interface
  declare global {
    interface Window {
      openContactModal: (modalId: string) => void;
      sa_event: (eventName: string, properties?: Record<string, any>) => void;
    }
  }
</script>
